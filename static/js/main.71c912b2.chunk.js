(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{20:function(e,t,n){e.exports=n(48)},25:function(e,t,n){},29:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(6),o=n.n(i),l=(n(25),n(5)),s=n(4),c=n.n(s),u=n(7),m=n(3),f=n(12),h=n(13),d=n(18),p=n(14),g=n(19),v=n(1),E=(n(29),n(15)),b=n.n(E),y=n(16),w=n.n(y),k=n(17),_=n.n(k),N=function(e){function t(){var e;Object(f.a)(this,t),e=Object(d.a)(this,Object(p.a)(t).call(this));var n=JSON.parse(localStorage.getItem("prwallconfig"))||{};return e.state={error:!1,bootstraped:!1,reviewsFetchFired:!1,prData:{},prReviews:{},mergeable:{},comments:{},teamMembers:[]},e.config=Object(m.a)({},{access_token:"",repo:"",refreshIntervalInMinutes:2,daysForOldMark:3,emoji:"no",vertical:"vertical",team:"",notifications:"no",notification_icon:"",font_size:16,repo_order:"default"},n),e.handleError=e.handleError.bind(Object(v.a)(Object(v.a)(e))),e.showConfig=e.showConfig.bind(Object(v.a)(Object(v.a)(e))),e.hideConfig=e.hideConfig.bind(Object(v.a)(Object(v.a)(e))),e.counter=0,e}return Object(g.a)(t,e),Object(h.a)(t,[{key:"changeFontSize",value:function(){document.getElementsByTagName("html")[0].style.fontSize=this.config.font_size+"px"}},{key:"getNotificationPermission",value:function(){"granted"!==Notification.permission&&Notification.requestPermission().then(function(e){return console.info("notifications "+e)})}},{key:"notifyNewPR",value:function(e){var t=this;e.forEach(function(e){var n=e.title,a={body:e.user.login,icon:e.user.avatar_url,requireInteraction:!0};""!==t.config.notification_icon&&(a.icon=t.config.notification_icon),new Notification(n,a)})}},{key:"checkNewPR",value:function(e,t){if(void 0!==e){var n=this.arraysDiff("id",e,t);n.length>0&&this.notifyNewPR(n)}}},{key:"arraysDiff",value:function(e,t,n){return t.filter(function(t){return!n.find(function(n){return t[e]===n[e]})})}},{key:"orderRepos",value:function(e){var t=this,n=this.config.repo.split(",").sort(function(n,a){return n=e[n.trim()].length,a=e[a.trim()].length,"asc"===t.config.repo_order.toLowerCase()?n===a?0:n<a?-1:1:n===a?0:n>a?-1:1});this.config.repo=n.join()}},{key:"showHideOrder",value:function(){var e=document.querySelector("#vertical").value,t=document.querySelector("#repo_order").parentElement;"vertical"===e?t.classList.add("hidden"):t.classList.remove("hidden")}},{key:"getUrl",value:function(e,t,n){var a=e?"https://api.github.com/repos/".concat(e,"/pulls"):n,r="";return"reviews"===t&&(r="/reviews"),this.config.access_token&&(r+="?access_token=".concat(this.config.access_token)),a+r}},{key:"fetchPullRequests",value:function(){var e=this,t={};void 0!==this.state.prData&&Object.assign(t,this.state.prData),this.config.repo.split(",").forEach(function(n){var a=n.trim();fetch(e.getUrl(a)).then(function(e){return e.json()}).then(function(n){!n||n.message?e.handleError(n):e.setState(function(r){var i=Object(m.a)({},r.prData);return i[a]=n.filter(function(t){return 0===e.state.teamMembers.length||e.state.teamMembers.includes(t.user.login)}),"granted"===Notification.permission&&"yes"===e.config.notifications&&Object.keys(t).length>0&&e.checkNewPR(n,t[a]),"vertical"!==e.config.vertical&&"default"!==e.config.repo_order.toLowerCase()&&(e.counter++,e.config.repo.split(",").length===e.counter&&(e.orderRepos(i),e.counter=0)),{error:!1,bootstraped:!0,prData:i,prReviews:{},reviewsFetchFired:!1}})}).catch(function(t){e.handleError(t)})})}},{key:"startFetching",value:function(){this.fetchPullRequests(),this.timer=window.setInterval(this.fetchPullRequests.bind(this),60*this.config.refreshIntervalInMinutes*1e3)}},{key:"fetchOrgTeams",value:function(){var e=Object(u.a)(c.a.mark(function e(){var t,n,a,r,i=this,o=arguments;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:1,n=this.config.team.split("/")[0],a=[],e.next=5,fetch("https://api.github.com/orgs/".concat(n,"/teams?access_token=").concat(this.config.access_token,"&page=").concat(t)).then(function(e){return e.json()}).then(function(e){e&&!e.message||i.handleError("No teams found!"),a=e});case 5:if(!(a.length>0)){e.next=10;break}return e.next=8,this.fetchOrgTeams(++t);case 8:r=e.sent,a=a.concat(r);case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTeamInfo",value:function(){var e=Object(u.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchOrgTeams();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setTeamInfo",value:function(){var e=this;this.getTeamInfo().then(function(t){var n=t.find(function(t){return t.slug===e.config.team.split("/")[1]});n?fetch("https://api.github.com/teams/".concat(n.id,"/members?access_token=").concat(e.config.access_token)).then(function(e){return e.json()}).then(function(t){var n=Array.isArray(t)&&t.map(function(e){return e.login});e.setState({teamMembers:n}),!e.timer&&e.startFetching()}):e.handleError("No team found!")})}},{key:"componentDidMount",value:function(){this.config.repo&&(this.config.team?(this.setTeamInfo(),window.setInterval(this.setTeamInfo.bind(this),864e5)):this.startFetching()),"yes"===this.config.notifications&&"denied"!==Notification.permission&&this.getNotificationPermission(),this.changeFontSize()}},{key:"componentDidUpdate",value:function(){var e=this;!this.state.reviewsFetchFired&&Object.keys(this.state.prData).length>0&&(Object.keys(this.state.prData).forEach(function(t){e.state.prData[t].forEach(function(n){fetch(e.getUrl(void 0,"reviews",n.url)).then(function(e){return e.json()}).then(function(a){if(a.message)e.handleError(a);else{var r=Object(m.a)({},e.state.prReviews,Object(l.a)({},t+"_"+n.number,a));e.setState({prReviews:r})}}).catch(function(t){return e.handleError(t)}),fetch(e.getUrl(void 0,"pull",n.url)).then(function(e){return e.json()}).then(function(a){a.message?e.handleError(a):e.setState(function(e){var r=Object(m.a)({},e.mergeable);r[t+"_"+n.number]={},r[t+"_"+n.number].mergeable=a.mergeable,r[t+"_"+n.number].mergeable_state=a.mergeable_state;var i=Object(m.a)({},e.comments);return i[t+"_"+n.number]=0,i[t+"_"+n.number]=a.comments+a.review_comments,{mergeable:r,comments:i}})}).catch(function(t){return e.handleError(t)})})}),this.setState({reviewsFetchFired:!0}))}},{key:"handleError",value:function(e){console.warn(e),this.setState({error:!0,bootstraped:!0})}},{key:"displayError",value:function(){return this.state.error?r.a.createElement("div",{className:"error"},"Error occured. Possible issue: API limit rate exceeded or service down or access_token not permitted or repo not found. If you reach API limit, it is good to raise the refresh rate interval to higher number. Check console/network."):""}},{key:"renderEmoji",value:function(e){if("no"===this.config.emoji)return"";var t="\ud83d\ude00";return e>0&&e<3&&(t="\ud83d\ude44"),e>2&&e<6&&(t="\ud83d\ude10"),e>5&&e<11&&(t="\ud83d\ude48"),e>10&&e<21&&(t="\ud83d\ude31"),e>20&&(t="\ud83d\udca9"),r.a.createElement("span",{role:"img","aria-label":"feeling based on comments"},t)}},{key:"renderPR",value:function(e,t){var n=this,a=this.state.mergeable[e+"_"+t.number]&&this.state.mergeable[e+"_"+t.number].mergeable&&"clean"===this.state.mergeable[e+"_"+t.number].mergeable_state?" mergeable":"",i=this.state.comments[e+"_"+t.number];return r.a.createElement("div",{key:t.number,className:"pull-request-wrap ".concat(function(e){var t=n.config.daysForOldMark,a="";return w()(new Date,new Date(e.updated_at))>=t&&(a="old"),a}(t),"  ").concat(a)},r.a.createElement("div",{className:"pull-request-title"},r.a.createElement("span",{className:"pull-request-user"},r.a.createElement("img",{src:t.user.avatar_url,title:t.user.login,alt:"user"})),r.a.createElement("span",{className:"pull-request-state"},t.state),r.a.createElement("span",null,t.title)),r.a.createElement("div",{className:"pull-request-meta"},r.a.createElement("div",null,r.a.createElement("span",{className:"pull-request-number"},r.a.createElement("a",{href:t.html_url,rel:"noopener noreferrer",target:"_blank"},t.number)),r.a.createElement("span",null,"Updated: ",r.a.createElement("span",{className:"pull-request-ago"},b()(new Date,new Date(t.updated_at)))," ago.")),r.a.createElement("div",null,r.a.createElement("div",{className:"review_comments"},r.a.createElement("span",{role:"img","aria-label":"comments:"},"\ud83d\udcac")," ",i," ",this.renderEmoji(i)),this.renderReviews(e,t.number))))}},{key:"saveConfig",value:function(){var e=document.querySelectorAll("input, select"),t={};e.forEach(function(e){t[e.name]=e.value}),localStorage.setItem("prwallconfig",JSON.stringify(t)),window.location.reload()}},{key:"showConfig",value:function(){this.setState({showConfig:!0})}},{key:"hideConfig",value:function(){this.setState({showConfig:!1})}},{key:"renderConfig",value:function(){return this.state.showConfig?r.a.createElement("div",{className:"config"},r.a.createElement("div",{className:"hide",onClick:this.hideConfig},"hide config"),r.a.createElement("div",{className:"app-name"},r.a.createElement("img",{src:"/app-icon.png",alt:"app-icon"})," ",r.a.createElement("span",null,"Github PR Wall montior")),r.a.createElement("form",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("input",{type:"text",name:"access_token",id:"access_token",placeholder:"access_token",defaultValue:this.config.access_token}),r.a.createElement("span",null,r.a.createElement("strong",null,"Access token: ")," Github access_token (Make sure to check REPO rights) ",r.a.createElement("a",{href:"https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/"},"Help"))),r.a.createElement("li",null,r.a.createElement("input",{type:"text",name:"repo",id:"repo",placeholder:"owner/repo",defaultValue:this.config.repo}),r.a.createElement("span",null,r.a.createElement("strong",null,"Repositories: "),"(e.g. if your repo is https://github.com/",r.a.createElement("strong",null,"facebook/create-react-app"),", you need to type ",r.a.createElement("strong",null,"facebook/create-react-app"),") You can have multiple repos, just separate them with comma (repo,repo)")),r.a.createElement("li",null,r.a.createElement("input",{type:"number",min:"1",name:"refreshIntervalInMinutes",id:"refreshIntervalInMinutes",defaultValue:this.config.refreshIntervalInMinutes}),r.a.createElement("span",null,r.a.createElement("strong",null,"Refresh rate: ")," in minutes")),r.a.createElement("li",null,r.a.createElement("input",{type:"number",min:"1",name:"daysForOldMark",id:"daysForOldMark",defaultValue:this.config.daysForOldMark}),r.a.createElement("span",{className:"old"},r.a.createElement("strong",null,"Highlight: "),"(in days) Days for old mark highlight")),r.a.createElement("li",null,r.a.createElement("input",{type:"text",name:"team",id:"team",placeholder:"organisation/my-team",defaultValue:this.config.team}),r.a.createElement("span",null,r.a.createElement("strong",null,"Team Filter: ")," If specified, show pull requests created only by members of the team, e.g. ",r.a.createElement("strong",null,"performgroup/my-team-slug")," (team members are checked only once per day)")),r.a.createElement("li",null,r.a.createElement("select",{name:"vertical",id:"vertical",defaultValue:this.config.vertical,onChange:this.showHideOrder},r.a.createElement("option",{value:"vertical"},"vertical"),r.a.createElement("option",{value:"horizontal"},"horizontal")),r.a.createElement("span",null,r.a.createElement("strong",null,"Display: "),"display setting for multiple repositories")),r.a.createElement("li",{className:"vertical"===this.config.vertical?"hidden":""},r.a.createElement("select",{name:"repo_order",id:"repo_order",defaultValue:this.config.repo_order},r.a.createElement("option",{value:"default"},"default"),r.a.createElement("option",{value:"asc"},"asc"),r.a.createElement("option",{value:"desc"},"desc")),r.a.createElement("span",null,r.a.createElement("strong",null,"Repo order: "),"order repositories by number of pull requests. ",r.a.createElement("strong",null,'"default"'),' will sort by order in the "Repositories" config item. (Works only in "horizontal" display mode. )')),r.a.createElement("li",null,r.a.createElement("select",{name:"emoji",id:"emoji",defaultValue:this.config.emoji},r.a.createElement("option",{value:"no"},"no"),r.a.createElement("option",{value:"yes"},"yes")),r.a.createElement("span",null,r.a.createElement("strong",null,"Show emoji: "),"based on comments number ")),r.a.createElement("li",null,r.a.createElement("select",{name:"notifications",id:"notifications",defaultValue:this.config.notifications},r.a.createElement("option",{value:"no"},"no"),r.a.createElement("option",{value:"yes"},"yes")),r.a.createElement("span",null,r.a.createElement("strong",null,"Browser notifications: ")," turn on/off to get notification in browser when you have tab open and switch to differnt tab")),r.a.createElement("li",null,r.a.createElement("input",{type:"text",name:"notification_icon",id:"notification_icon",defaultValue:this.config.notification_icon}),r.a.createElement("span",null,r.a.createElement("strong",null,"Notification icon: "),"URL string - if set it will always display specified image from the url")),r.a.createElement("li",null,r.a.createElement("input",{type:"number",name:"font_size",id:"font_size",defaultValue:this.config.font_size}),r.a.createElement("span",null,r.a.createElement("strong",null,"Font size: "),"default font-size - other elements will scale accordingly")),r.a.createElement("li",null,r.a.createElement("span",{className:"button",onClick:this.saveConfig},"Save Config"))))):r.a.createElement("div",{className:"show",onClick:this.showConfig},"Show Config")}},{key:"renderReviews",value:function(e,t){var n=["APPROVED","CHANGES_REQUESTED"],a=this.state.prReviews[e+"_"+t];if(!a||"function"!==typeof a.filter)return r.a.createElement("img",{className:"reviews-loading",src:"https://loading.io/spinners/dual-ring/index.dual-ring-loader.svg",alt:"loading"});var i=a.filter(function(e){return n.includes(e.state)}).map(function(e){return r.a.createElement(_.a,{key:e.id,className:"pull-request-reivew-tooltip",content:e.user.login},r.a.createElement("span",{className:e.state+" pull-request-review"},r.a.createElement("img",{src:e.user.avatar_url,alt:"user review"}),r.a.createElement("span",{className:"overlay"})))});return 0===i.length?r.a.createElement("span",{className:"no-reviews"},"No reviews yet"):i}},{key:"renderRepo",value:function(e){var t=this,n=this.state.prData[e];return n?r.a.createElement("div",{key:e,className:e},r.a.createElement("h4",{className:"repo-heading"},e),n.map(function(n){return t.renderPR(e,n)})):r.a.createElement("div",{key:e},r.a.createElement("h4",{className:"repo-heading"},e))}},{key:"render",value:function(){var e=this;return this.state.bootstraped?r.a.createElement("div",null,r.a.createElement("div",{className:"legend"},r.a.createElement("ul",null,r.a.createElement("li",{className:"mergable"},"is mergable"),r.a.createElement("li",{className:"old"},"older then ",this.config.daysForOldMark," days"),this.config.team?r.a.createElement("li",{className:"teamFilter"},r.a.createElement("span",{role:"img","aria-label":"team"}," team \ud83d\ude0e:")," ",this.config.team):"")),this.renderConfig(),this.displayError(),r.a.createElement("div",{className:"all-repos-wrap "+("vertical"===this.config.vertical?"vertical":"horizontal")},this.config.repo.split(",").map(function(t){return e.renderRepo(t.trim())}))):r.a.createElement("div",null,this.renderConfig(),r.a.createElement("p",{style:{color:"#fff"}},"If loading takes too long, check your app config and network connection"),r.a.createElement("img",{src:"https://loading.io/spinners/dual-ring/index.dual-ring-loader.svg",alt:"loading"}))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(N,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[20,2,1]]]);
//# sourceMappingURL=main.71c912b2.chunk.js.map